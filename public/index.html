<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ロマンス農園</title>
  
  <!-- Preload critical CSS -->
  <link rel="preload" href="css/style.css" as="style">
  <link rel="stylesheet" href="css/style.css">
  
  <!-- Defer non-critical CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="css/multiple-shipping.css" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="css/admin.css" media="print" onload="this.media='all'">
  
  <!-- Fallback for browsers that don't support onload -->
  <noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="css/multiple-shipping.css">
    <link rel="stylesheet" href="css/admin.css">
  </noscript>
</head>
<body>
  <header>
    <div class="container">
      <div class="logo">
        <h1>ロマンス農園</h1>
      </div>
      <nav>
        <ul class="nav-links">
          <li><a href="#" class="active" data-tab="home">ホーム</a></li>
          <li><a href="#" data-tab="products">商品一覧</a></li>
          <li><a href="#" data-tab="orders">注文</a></li>
          <li><a href="#" data-tab="account">アカウント</a></li>
          <li class="admin-link hidden"><a href="#" data-tab="admin">管理者</a></li>
        </ul>
      </nav>
      <div class="user-actions">
        <div class="auth-buttons">
          <button id="login-btn" class="btn">ログイン</button>
          <button id="register-btn" class="btn btn-primary">登録</button>
        </div>
        <div class="user-profile hidden">
          <span class="user-name">ユーザー名</span>
          <button id="logout-btn" class="btn">ログアウト</button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <!-- Home Tab -->
      <section id="home" class="tab-content active">
        <div class="hero">
          <div class="hero-content">
            <h2>苫小牧・樽前から新鮮な商品を直接お届け</h2>
            <p>北海道の大地から採れたてのアスパラをご自宅まで。</p>
            <p>品質と鮮度にこだわった商品をお届けします。</p>
            <button class="btn btn-primary btn-large" data-action="shop-now">今すぐ購入</button>
          </div>
        </div>

        <div class="featured-categories">
          <h3>カテゴリー</h3>
          <div class="category-grid">
            <div class="category-card" data-category="アスパラ">
              <img src="images/アスパラ２" alt="アスパラ">
              <h4>アスパラ</h4>
            </div>
            <div class="category-card" data-category="はちみつ">
              <img src="images/ハチミツ" alt="はちみつ">
              <h4>はちみつ</h4>
            </div>
          </div>
        </div>

        <div class="featured-products">
          <h3>おすすめ商品</h3>
          <div class="product-grid" id="featured-products-grid">
            <!-- Products will be loaded here dynamically -->
          </div>
        </div>
      </section>

      <!-- Products Tab -->
      <section id="products" class="tab-content">
        <div class="products-header">
          <h2>商品一覧</h2>
          <div class="filters">
            <div class="search-box">
              <input type="text" id="product-search" placeholder="商品を検索...">
              <button class="btn" id="search-btn"><i class="fas fa-search"></i></button>
            </div>
            <div class="category-filter">
              <select id="category-select">
                <option value="">すべてのカテゴリー</option>
                <option value="アスパラ">アスパラ</option>
                <option value="はちみつ">はちみつ</option>
              </select>
            </div>
            <div class="stock-filter">
              <label>
                <input type="checkbox" id="in-stock-only">
                在庫あり商品のみ
              </label>
            </div>
          </div>
        </div>
        <div class="product-grid" id="all-products-grid">
          <!-- Products will be loaded here dynamically -->
        </div>
      </section>

      <!-- Orders Tab -->
      <section id="orders" class="tab-content">
        <h2>注文履歴</h2>
        <div class="auth-required-message">
          <p>注文履歴を表示するにはログインしてください。</p>
          <button class="btn btn-primary" id="orders-login-btn">ログイン</button>
        </div>
        <div class="orders-list hidden">
          <!-- Orders will be loaded here dynamically -->
        </div>
      </section>

      <!-- Account Tab -->
      <section id="account" class="tab-content">
        <h2>アカウント情報</h2>
        <div class="auth-required-message">
          <p>アカウント情報を表示するにはログインしてください。</p>
          <button class="btn btn-primary" id="account-login-btn">ログイン</button>
        </div>
        <div class="account-details hidden">
          <div class="profile-section">
            <h3>プロフィール</h3>
            <form id="profile-form">
              <div class="form-group">
                <label for="name">名前</label>
                <input type="text" id="name" name="name">
              </div>
              <div class="form-group">
                <label for="email">メールアドレス</label>
                <input type="email" id="email" name="email">
              </div>
              <button type="submit" class="btn btn-primary">更新</button>
            </form>
          </div>
          <div class="addresses-section">
            <h3>配送先住所</h3>
            <div class="addresses-list">
              <!-- Addresses will be loaded here dynamically -->
            </div>
            <button class="btn" id="add-address-btn">新しい住所を追加</button>
          </div>
        </div>
      </section>

      <!-- Admin Tab -->
      <section id="admin" class="tab-content">
        <h2>管理者ダッシュボード</h2>
        <div class="admin-tabs">
          <button class="admin-tab-btn active" data-admin-tab="dashboard">ダッシュボード</button>
          <button class="admin-tab-btn" data-admin-tab="orders">注文管理</button>
          <button class="admin-tab-btn" data-admin-tab="products">商品管理</button>
          <button class="admin-tab-btn" data-admin-tab="users">ユーザー管理</button>
          <button class="admin-tab-btn" data-admin-tab="reports">レポート</button>
        </div>
        <div class="admin-tab-content">
          <div id="admin-dashboard" class="admin-tab-panel active">
            <!-- Dashboard content will be loaded here dynamically -->
          </div>
          <div id="admin-orders" class="admin-tab-panel">
            <!-- Orders management content will be loaded here dynamically -->
          </div>
          <div id="admin-products" class="admin-tab-panel">
            <!-- Products management content will be loaded here dynamically -->
          </div>
          <div id="admin-users" class="admin-tab-panel">
            <!-- Users management content will be loaded here dynamically -->
          </div>
          <div id="admin-reports" class="admin-tab-panel">
            <!-- Reports content will be loaded here dynamically -->
          </div>
        </div>
      </section>

      <!-- Cart Tab has been removed -->
    </div>
  </main>

  <!-- Modals -->
  <div class="modal" id="login-modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>ログイン</h2>
      <form id="login-form">
        <div class="form-group">
          <label for="login-email">メールアドレス</label>
          <input type="email" id="login-email" name="email" required>
        </div>
        <div class="form-group">
          <label for="login-password">パスワード</label>
          <input type="password" id="login-password" name="password" required>
        </div>
        <button type="submit" class="btn btn-primary" id="login-submit-btn">ログイン</button>
      </form>
      <div class="social-login">
        <p>または</p>
        <button type="button" id="google-login-btn" class="btn btn-google">
          <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google logo" width="18" height="18">
          Googleでログイン
        </button>
      </div>
      <p class="form-switch">アカウントをお持ちでない方は <a href="#" id="switch-to-register">登録</a></p>
    </div>
  </div>

  <div class="modal" id="register-modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>アカウント登録</h2>
      <form id="register-form">
        <div class="form-group">
          <label for="register-name">名前</label>
          <input type="text" id="register-name" name="name" required>
        </div>
        <div class="form-group">
          <label for="register-email">メールアドレス</label>
          <input type="email" id="register-email" name="email" required>
        </div>
        <div class="form-group">
          <label for="register-password">パスワード</label>
          <input type="password" id="register-password" name="password" required>
        </div>
        <div class="form-group">
          <label for="register-password-confirm">パスワード（確認）</label>
          <input type="password" id="register-password-confirm" name="passwordConfirm" required>
        </div>
        <button type="submit" class="btn btn-primary">登録</button>
      </form>
      <p class="form-switch">すでにアカウントをお持ちの方は <a href="#" id="switch-to-login">ログイン</a></p>
    </div>
  </div>

  <div class="modal" id="product-modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <div class="product-details">
        <!-- Product details will be loaded here dynamically -->
      </div>
    </div>
  </div>

  <div class="modal" id="checkout-modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>注文手続き</h2>
      <div class="checkout-steps">
        <div class="step active" data-step="shipping">
          <span class="step-number">1</span>
          <span class="step-title">配送情報</span>
        </div>
        <div class="step" data-step="payment">
          <span class="step-number">2</span>
          <span class="step-title">支払い方法</span>
        </div>
        <div class="step" data-step="confirm">
          <span class="step-number">3</span>
          <span class="step-title">注文確認</span>
        </div>
      </div>
      <div class="checkout-content">
        <div class="checkout-step-content active" id="shipping-step">
          <!-- Shipping step content will be loaded here dynamically -->
        </div>
        <div class="checkout-step-content" id="payment-step">
          <!-- Payment step content will be loaded here dynamically -->
        </div>
        <div class="checkout-step-content" id="confirm-step">
          <!-- Confirmation step content will be loaded here dynamically -->
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="address-modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>配送先住所</h2>
      <form id="address-form">
        <div class="form-group">
          <label for="address-name">名前</label>
          <input type="text" id="address-name" name="name" required>
        </div>
        <div class="form-group">
          <label for="address-phone">電話番号</label>
          <input type="tel" id="address-phone" name="phone" required>
        </div>
        <div class="form-group">
          <label for="address-street">住所</label>
          <input type="text" id="address-street" name="address" required>
        </div>
        <div class="form-group">
          <label for="address-city">市区町村</label>
          <input type="text" id="address-city" name="city" required>
        </div>
        <div class="form-group">
          <label for="address-postal">郵便番号</label>
          <input type="text" id="address-postal" name="postalCode" required>
        </div>
        <div class="form-group checkbox">
          <label>
            <input type="checkbox" id="address-default" name="isDefault">
            デフォルトの配送先として設定
          </label>
        </div>
        <button type="submit" class="btn btn-primary">保存</button>
      </form>
    </div>
  </div>

  <footer>
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3>ロマンス農園</h3>
          <p>苫小牧から新鮮なアスパラをお届け</p>
        </div>
        <div class="footer-section">
          <h3>リンク</h3>
          <ul>
            <li><a href="#">ホーム</a></li>
            <li><a href="#">商品一覧</a></li>
            <li><a href="#">注文方法</a></li>
            <li><a href="#">お問い合わせ</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>お問い合わせ</h3>
          <p>住所　: 北海道苫小牧市樽前90</p>
          <p>メール: info@farm-direct.jp</p>
          <p>電話　: 03-1234-5678</p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 RomanceFarm. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Load Auth module directly first to ensure it's defined before any scripts that depend on it -->
  <script src="js/api.js"></script>
  <script src="js/auth.js"></script>
  
  <!-- Initialize Auth module immediately -->
  <script>
    // Initialize Auth module as soon as it's loaded
    if (typeof Auth !== 'undefined' && typeof Auth.init === 'function') {
      console.log('Initializing Auth module immediately');
      Auth.init().catch(err => console.error('Error initializing Auth:', err));
    } else {
      console.error('Auth module not properly defined after loading auth.js');
    }
  </script>
  
  <!-- Load remaining core scripts -->
  <script src="js/products.js"></script>
  <script src="js/orders.js"></script>
  <script src="js/app.js"></script>
  
  <!-- Login fix script to ensure login button works correctly -->
  <script src="js/login-fix.js"></script>
  
  <!-- Load admin scripts after Auth is initialized -->
  <script>
    // Load admin scripts after Auth is initialized
    document.addEventListener('DOMContentLoaded', () => {
      console.log('Loading admin scripts...');
      const adminScript = document.createElement('script');
      adminScript.src = 'js/build/admin.min.js';
      adminScript.onload = () => {
        console.log('Admin scripts loaded successfully');
      };
      document.body.appendChild(adminScript);
    });
  </script>
  
  <!-- Defer non-critical scripts to improve initial load time -->
  <script src="js/multiple-shipping.js" defer></script>
  <!-- orders.js is already included in core.min.js, removing duplicate -->
  <script src="js/account.js" defer></script>
  <!-- Load admin-helpers.js after admin.min.js to ensure AdminModule is defined -->
  <script>
    // Wait for AdminModule to be defined before loading admin-helpers.js
    document.addEventListener('DOMContentLoaded', () => {
      // Check if admin.min.js has been loaded
      const adminScriptLoaded = () => {
        return typeof AdminModule !== 'undefined';
      };
      
      // Function to load admin-helpers.js
      const loadAdminHelpers = () => {
        console.log('Loading admin-helpers.js...');
        const helperScript = document.createElement('script');
        helperScript.src = 'js/admin-helpers.js';
        helperScript.onload = () => {
          console.log('admin-helpers.js loaded successfully');
        };
        document.body.appendChild(helperScript);
      };
      
      // If AdminModule is already defined, load helpers immediately
      if (adminScriptLoaded()) {
        console.log('AdminModule already defined, loading helpers immediately');
        loadAdminHelpers();
      } else {
        console.log('AdminModule not defined yet, waiting...');
        // Otherwise, wait for admin.min.js to load and define AdminModule
        let retries = 0;
        const maxRetries = 50; // 5 seconds (50 * 100ms)
        
        const checkInterval = setInterval(() => {
          retries++;
          
          if (adminScriptLoaded()) {
            clearInterval(checkInterval);
            console.log('AdminModule found, loading helpers');
            loadAdminHelpers();
          } else if (retries >= maxRetries) {
            clearInterval(checkInterval);
            console.warn('Timed out waiting for AdminModule to be defined. Loading helpers anyway.');
            loadAdminHelpers();
          }
        }, 100);
      }
    });
  </script>
</body>
</html>
